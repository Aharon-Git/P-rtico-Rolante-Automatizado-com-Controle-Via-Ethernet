// Digite um endereço MAC e um endereço IP para seu controlador abaixo.

// O endereço IP irá depender da sua rede local:

byte mac[] = {
  0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED
};

boolean visu = true;

IPAddress ip(192, 168, 1, 101);

// Inicialize a biblioteca do servidor Ethernet

// com o endereço IP e a porta que você deseja usar

// (porta 80 é o padrão para HTTP):

EthernetServer server(80);

void setup() {

 // Abra as comunicações seriais e aguarde a porta abrir:

  Serial.begin(9600);
  while (!Serial) {
    ; 
// Aguarde a conexão da porta serial, necessário apenas para porta USB nativa
  }


  // Iniciar a conexão Ethernet e o servidor:

  Ethernet.begin(mac, ip);
  server.begin();
  Serial.print("server is at ");
  Serial.println(Ethernet.localIP());
}


void loop() {
  if (analogRead(A0)> 1000)visu = false; 
  else visu = true;
    
  // Escuta os clientes recebidos

  EthernetClient client = server.available();
  if (client) {
    Serial.println("new client");

    
// Uma solicitação HTTP termina com uma linha em branco

    boolean currentLineIsBlank = true;
    while (client.connected()) {
      if (client.available()) {
        char c = client.read();
        Serial.write(c);

        // Se você chegou ao final da linha (recebeu uma nova linha caractere) e se a linha estiver em branco, a solicitação HTTP terminou

        // Para que você possa enviar uma resposta

        if (c == '\n' && currentLineIsBlank) {

          // Envia um cabeçalho de resposta HTTP padrão

          client.println("HTTP/1.1 200 OK");
          client.println("Content-Type: text/html");
          client.println("Connection: close");  

// A conexão será fechada após a conclusão da resposta

          client.println("Refresh: 5");  

// Atualiza a página automaticamente a cada 5 segundos

          client.println();
          client.println("<!DOCTYPE HTML>");
          client.println("<html>");

          // Emitir o valor de cada pino de entrada analógica

          for (int analogChannel = 0; analogChannel < 1; analogChannel++) {
            int sensorReading = analogRead(analogChannel);
            client.print("<head>");
            client.print("<title>PORTICO ROLANTE OK</title>");


	// Todo design e layout do site deverá ser feito em HTML como os códigos abaixo:

            client.print("<style>html{margin: 0.1em 7.5em 0.1em 7.5em;} div{border: 1px solid; padding: 0.65em; background-color: #DCDCDC; font-size: 2.5em; text-align: center;} header{border: 1px solid; margin-bottom: -1px;background-color: #DCDCDC; padding: 0.65em 1em 0.65em 1em; font-size: 3.8em; text-align: center;} h1{margin: 0;} .run{height: 30px; width: 200px; } div.rele1{position:absolute; top:250px; right:150px; border:1px solid black; margin:auto; background color: blue; height: 300px; width: 200px;}</style>");
            client.print("<script>function AlteraRele1(){var estado=document.getElementById('estado').innerHTML; if (estado===0)document.getElementById('estado').innerHTML='1'; document.getElementById('rele').innerHTML='<div class='rele1'></div>';} else {document.getElementById('estado').innerHTML='0';document.getElementById('rele').innerHTML='<div class='rele2'></div>';}</script>");
            client.print("<script>AlteraRele1()</script>");
            client.print("</head>");
            
            client.print("<header>");
            client.print("<body>");
            
            client.print("<h1 class='topo' style='color: #483D8B;'>PORTICO ROLANTE""</h1>");
            client.print("</header>");

            client.print("<div id='rele'> </div><div id='estado' style='visibility:hidden'>");
            client.print(visu);
            client.print("</div>");
            
            client.print("<div>");
            client.print("<form>");
            client.print("Eixo X:");
            client.print("<input class='run' type='text' 'name='Eixo X'/><br>");
            
            client.println("<br />");          
                                    
            client.print("Eixo Y:");
            client.print("<input class='run' type='text' 'name='Eixo Y'/><br>");
              
            client.println("<br />");                      
            
            client.print("Eixo Z:");
            client.print("<input class='run' type='text' 'name=''Eixo Z'/><br>");
            client.print("</form>");  
            client.println("<br />");          
                        
            client.print("</div>");
            client.print("</body>");
          }
          client.println("</html>");
          break;
        }Serial.println(analogRead(A0));
        if (c == '\n') {

          // Você está começando uma nova linha

          currentLineIsBlank = true;
        } else if (c != '\r') {

          // Você conseguiu um personagem na linha atual

          currentLineIsBlank = false;
        }
      }
    }
    // Dar tempo ao navegador para receber os dados

    delay(1);

    // Termina a conexão:

    client.stop();
    Serial.println("client disconnected");
  }
} 
